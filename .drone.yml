kind: pipeline
type: docker
name: default

steps:
- name: clean
  image: mcr.microsoft.com/dotnet/core/sdk:3.0
  commands:
  - dotnet clean Drone-POC/Core/Core.csproj

- name: build
  image: mcr.microsoft.com/dotnet/core/sdk:3.0
  commands:
  - dotnet build Drone-POC/Core/Core.csproj
  
trigger:
  branch:
  - develop
---
kind: pipeline
type: docker
name: web

steps:
- name: clean
  image: mcr.microsoft.com/dotnet/core/sdk:3.0
  commands:
  - dotnet clean Drone-POC/WebApplication2/WebApplication2.csproj

- name: build
  image: mcr.microsoft.com/dotnet/core/sdk:3.0
  commands:
  - dotnet build Drone-POC/WebApplication2/WebApplication2.csproj
  
- name: publish
  image: mcr.microsoft.com/dotnet/core/sdk:3.0
  volumes:
  - name: webdir
    path: /root/.webdir/web
  commands:
  - apt install zip unzip
  - dotnet publish --configuration Release Drone-POC/WebApplication2/WebApplication2.csproj
  - cd /drone/src/Drone-POC/WebApplication2/bin/Release/netcoreapp3.0/publish/
  - cp -r /drone/src/Drone-POC/WebApplication2/bin/Release/netcoreapp3.0/publish/ /drone/src/web
  - zip -r output_file.zip /drone/src/Drone-POC/WebApplication2/bin/Release/netcoreapp3.0/publish/
  - dir
  
#- name: deploy
  #image: cschlosser/drone-ftps
  #environment:
    #FTP_USERNAME: testingapp-drone\$testingapp-drone
    #FTP_PASSWORD: ZAJPdy5by2mjK8j6pXjAoZ9vKPLBZ0i2QLu3BnGdFPiSkBawQP6uCmAMr3Zx
    #PLUGIN_HOSTNAME: ftps://waws-prod-dm1-057.ftp.azurewebsites.windows.net/site/wwwroot
    #PLUGIN_SRC_DIR: /drone/src/Drone-POC/WebApplication2/bin/Release/netcoreapp3.0/publish/
    #PLUGIN_SECURE: true

trigger:
  branch:
  - develop
  
volumes:
- name: webdir
  temp: {}
#---
#kind: pipeline
#type: docker
#name: deploy

#steps:
#- name: clean
#  image: mcr.microsoft.com/dotnet/core/sdk:3.0
#  volumes:
#  - name: webdir
#    path: /root/.webdir/web
#  commands:
#  - cd  /drone/src/web
#  - ls
#  - dir

#depends_on:
#- web#

#volumes:
#- name: webdir
#  temp: {}

#pipeline:
#  deploy:
#    image: cschlosser/drone-ftps
#    hostname: ftps://waws-prod-dm1-057.ftp.azurewebsites.windows.net/site/wwwroot:21
#    secrets: [ ftp_username, ftp_password ]
#    secure: true
#+   src_dir: /drone/src/Drone-POC/WebApplication2/bin/Release/netcoreapp3.0/publish/
#
#depends_on:
#- web build
